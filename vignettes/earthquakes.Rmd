---
title: "earthquakes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{earthquakes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
```

```{r setup}
library(earthquakes)
```

This vignette uses the same examples as the GitHub README file.

# Using this Package

Loading the relevant packages for these examples:

```{r, packages}
library(earthquakes)
library(leaflet)
```

## Reading Data

View the 10 most deadly earthquakes after the year 2000:

```{r, 20years}
data <- eq_clean_data() %>% 
    dplyr::filter(!is.na(TOTAL_DEATHS)) %>% 
    dplyr::select(DATE, YEAR, COUNTRY, REGION, LONGITUDE, LATITUDE, MAG, TOTAL_DEATHS) %>%
  tidyr::drop_na()
data %>% 
  dplyr::filter(YEAR > 1999) %>%
  dplyr::arrange(desc(TOTAL_DEATHS)) %>%
                   head(n = 10)
```


## Timeline Geom

Plot a timeline of deadly earthquakes in 3 different countries:

```{r, timeline, eval = FALSE}
data %>% dplyr::filter(YEAR > 1999,
                       COUNTRY %in% c("JAPAN", "CHINA","NEPAL")) %>%
    ggplot2::ggplot() +
    geom_timeline(aes(x = DATE,
                      y = COUNTRY,
                      size = MAG,
                      color = TOTAL_DEATHS))
```

```{r timeline1, echo=FALSE, out.width = '100%'}
knitr::include_graphics(file.path("..","man","figures","README-timeline-1.png"))
```

## Annotated Timeline

Label the 5 most deadly earthquakes in the Japan since 1900:

```{r, timelinelabel, eval = FALSE}
data %>% dplyr::filter(COUNTRY == "JAPAN", 
                              YEAR >= 1900) %>%
  ggplot2::ggplot(aes(x = DATE,
                      y = COUNTRY,
                      size = MAG,
                      color = TOTAL_DEATHS,
                      label = REGION,
                      mag = MAG)) +
  geom_timeline() +
  geom_timeline_label(aes(n_max = 5))
```

```{r timelinelabel1, echo=FALSE, out.width = '100%'}
knitr::include_graphics(file.path("..","man","figures","README-timelinelabel-1.png"))
```

## Basic Leaflet Map

Plot the epicenters on a leaflet map:

```{r, basicmap, eval = FALSE}
data %>% 
  dplyr::filter(COUNTRY == "MEXICO", 
                YEAR >= 2000) %>% 
  eq_map(annot_col = "DATE")
```

```{r basicmap1, echo=FALSE, out.width = '100%'}
knitr::include_graphics(file.path("..","man","figures","eq_map.png"))
```

## Fancier Labels

Leaflet maps with more information included in the popups:

```{r, fancymap, eval = FALSE}
data %>% 
  dplyr::filter(COUNTRY == "MEXICO",
                YEAR >= 2000) %>% 
  dplyr::mutate(popup_text = eq_create_label(.)) %>% 
  eq_map(annot_col = "popup_text")
```

```{r fancymap1, echo=FALSE, out.width = '100%'}
knitr::include_graphics(file.path("..","man","figures","eq_create_label.png"))
```
